<?xml version="1.0" encoding="UTF-8"?>

<mapper namespace="com.ssg.dojangfarm.dao.mybatis.mapper.AuctionMapper">
  <cache />
  	<!-- Auction -->
  	<select id="getAuctionList" resultType="Auction">
    	SELECT 
    		Auction.aNo, title, minPrice, deadline,
    		imPurPrice, bidPrice 
    	FROM Auction, Bid
    	WHERE 
    		Auction.aNo = Bid.aNo
  	</select>
  	
  	<select id="findAuctionByTitle" parameterType="int" resultType="Auction">
    	SELECT 
    		Auction.aNo, title, minPrice, deadline,
    		imPurPrice, bidPrice 
    	FROM Auction, Bid
    	WHERE 
    		Auction.aNo = Bid.aNo AND
    		title = #{title}
  	</select>
  	
  	<select id="findAuctionByProduct" parameterType="String" resultType="Auction">
    	SELECT 
    		Auction.aNo, title, minPrice, deadline,
    		imPurPrice, bidPrice 
    	FROM Auction, Bid, Product
    	WHERE 
    		Auction.aNo = Bid.aNo AND
    		Auction.pNo = Product.pNo AND
    		Product.pName = #{pName}
    		
  	</select>
  	
  	<select id="getMyAuctionList" parameterType="int" resultType="Auction">
    	SELECT 
    		Auction.aNo, title, minPrice, deadline,
    		imPurPrice, bidPrice, finish 
    	FROM Auction, Bid
    	WHERE 
    		Auction.aNo = Bid.aNo
  	</select>
  	
  	<select id="getAuction" parameterType="int" resultType="Auction">
    	SELECT 
    		aNo, title, detail, minPrice, deadline,
    		imPurAva, imPurPrice, finish, 
    		Auction.userNo, id, Auction.pNo, pName
    	FROM Auction, Product, User
    	WHERE 
    		Auction.pNo = Product.pNo AND
    		Auction.userNo = User.userNo AND
    		aNo = #{aNo}
  	</select>
  	
  	<insert id="registerAuction" parameterType="Auction">
    	INSERT INTO Auction 
    		(aNo, title, detail, minPrice, deadline,
    		imPurAva, imPurPrice, userNo, pNo)
    	VALUES 
    		(#{aNo}, #{title}, #{detail}, #{minPrice}, #{deadline}, 
    		#{imPurAva}, #{imPurPrice}, #{user.userNo}, #{product.pNo})
  	</insert>
  	
  	<select id="getUserNoByAuction" parameterType="int" resultType="User">
    	SELECT 
    		userNo
    	FROM Auction
    	WHERE 
    		aNo = #{aNo}
  	</select>
  	
  	
  	
  	
  	<select id="getMyBidList" parameterType="int" resultType="Bid">
    	SELECT 
    		bidNo, bidPrice, state, deadline, title, Auction.aNo
    	FROM Bid, Auction
    	WHERE 
    		Auction.aNo = Bid.aNo AND
    		userNo = #{userNo}
  	</select>
  	
  	???
  	<select id="getBid" parameterType="int" resultType="Bid">
    	SELECT 
    		bidNo, bidPrice, state, deadline, title, Auction.aNo
    	FROM Bid, Auction
    	WHERE 
    		Auction.aNo = Bid.aNo AND
    		bidNo = #{bidNo}
  	</select>
  	
  	<insert id="bidAuction" parameterType="Bid">
    	INSERT INTO Bid 
    		(bidNo, bidPrice, userNo, aNo)
    	VALUES 
    		(#{bidNo}, #{bidPrice}, #{user.userNo}, #{auction.aNo})
  	</insert>
  	
  	
  	
  	
  
  	<select id="getMySBidList" parameterType="int" resultType="Auction">
    	SELECT 
    		sBidNo, payState, Auction.aNo, Bid.bidNo, bid.bidPrice
    	FROM SBid, Auction, Bid
    	WHERE 
    		Bid.bidNo = SBid.bidNo AND
    		Auction.aNo = Bid.aNo AND
    		SBid.userNo = #{userNo}
  	</select>
  	
  	<select id="getMySBid" parameterType="int" resultType="Auction">
    	SELECT 
    		sBidNo, payState, Auction.aNo, title, Bid.bidNo, bid.bidPrice,
    		Delivery.dNo,
    		Payment.payNo
    	FROM SBid, Bid, Auction, Delivery, Payment
    	WHERE 
    		Bid.bidNo = SBid.bidNo AND
    		Auction.aNo = Bid.aNo AND
    		Delivery.dNo = SBid.dNo AND
    		Payment.payNo = SBid.payNo AND
    		imPurNo = #{imPurNo}
  	</select>
  	
  	<select id="getSBidByAuction" parameterType="int" resultType="Auction">
    	SELECT 
    		sBidNo, Auction.aNo, title, imPurPrice, User.userNo, Bid.bidNo, id
    	FROM SBid, Bid, User, Auction
    	WHERE 
    		Bid.bidNo = SBid.bidNo AND
    		Auction.aNo = Bid.aNo AND
    		Bid.userNo = User.userNo
    		userNo = #{userNo}
  	</select>
  	
  	<insert id="successBid" parameterType="SBid">
    	INSERT INTO ImPur 
    		(sBidNo, bidNo, dNo, payNo)
    	VALUES 
    		(#{imPurNo}, #{bid.bidNo}, #{delivery.dNo}, #{payment.payNo})
  	</insert>
  	
  	
  	
  	
  	
  	<select id="getMyImPurList" parameterType="int" resultType="Auction">
    	SELECT 
    		imPurNo, Auction.aNo, title, imPurPrice
    	FROM ImPur, Auction
    	WHERE 
    		Auction.aNo = ImPur.aNo AND
    		ImPur.userNo = #{userNo}
  	</select>
  	
  	<select id="getMyImPur" parameterType="int" resultType="Auction">
    	SELECT 
    		imPurNo, Auction.aNo, title, imPurPrice,
    		Delivery.dNo,
    		Payment.payNo
    	FROM ImPur, Auction, Delivery, Payment
    	WHERE 
    		Auction.aNo = ImPur.aNo AND
    		Delivery.dNo = ImPur.dNo AND
    		Payment.payNo = ImPur.payNo AND
    		imPurNo = #{imPurNo}
  	</select>
  	
  	<select id="getImPurByAuction" parameterType="int" resultType="Auction">
    	SELECT 
    		imPurNo, Auction.aNo, title, imPurPrice, User.userNo, id
    	FROM ImPur, Auction, User
    	WHERE 
    		Auction.aNo = ImPur.aNo AND
    		User.userNo = ImPur.userNo AND
    		userNo = #{userNo}
  	</select>
  	
  	<insert id="immePurchase" parameterType="ImPur">
    	INSERT INTO ImPur 
    		(imPurNo, userNo, aNo, dNo, payNo)
    	VALUES 
    		(#{imPurNo}, #{user.userNo}, #{auction.aNo}, 
    		 #{delivery.dNo}, #{payment.payNo})
  	</insert>
  	
 </mapper>